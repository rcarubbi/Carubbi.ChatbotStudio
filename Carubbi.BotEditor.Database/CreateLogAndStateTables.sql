DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'Carubbi.BotEditor.Api.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201809281333348_Initial Setup'
BEGIN
    CREATE TABLE [dbo].[SqlBotDataEntities] (
        [Id] [int] NOT NULL IDENTITY,
        [BotStoreType] [int] NOT NULL,
        [BotId] [nvarchar](max),
        [ChannelId] [nvarchar](200),
        [ConversationId] [nvarchar](200),
        [UserId] [nvarchar](200),
        [Data] [varbinary](max),
        [ETag] [nvarchar](max),
        [ServiceUrl] [nvarchar](max),
        [Timestamp] [datetimeoffset](7) NOT NULL,
        CONSTRAINT [PK_dbo.SqlBotDataEntities] PRIMARY KEY ([Id])
    )
    CREATE INDEX [idxStoreChannelConversation] ON [dbo].[SqlBotDataEntities]([BotStoreType], [ChannelId], [ConversationId])
    CREATE INDEX [idxStoreChannelConversationUser] ON [dbo].[SqlBotDataEntities]([BotStoreType], [ChannelId], [ConversationId], [UserId])
    CREATE INDEX [idxStoreChannelUser] ON [dbo].[SqlBotDataEntities]([BotStoreType], [ChannelId], [UserId])
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201809281333348_Initial Setup', N'Carubbi.BotEditor.Api.Migrations.Configuration',  0x1F8B0800000000000400CD595B4FE346147EAFD4FF60F9A995B23649584A51B22B08B08ABA01B401DE27F64918753C7667C651A2AABFAC0FFD49FD0B3DE3EBD8CEC5092CAA78819973BE739D7331FFFEFDCFE0F32A60D61284A4211FDA5DE7C4B6807BA14FF96268C76AFEE1DCFEFCE9C71F06377EB0B29E73BABEA6434E2E87F68B52D185EB4AEF0502229D807A2294E15C395E18B8C40FDDDEC9C9AF6EB7EB0242D8886559836F31573480E40FFC7314720F22151336097D60323BC79B69826ADD910064443C18DA37DE4B7815AAE7BE335544816D5D324A508D29B0B96D11CE433C46252F9E244C9508F9621AE101618FEB08906E4E98844CF98B92BCAD1D273D6D875B32E6505E2C55181C08D8ED678E71EBEC47B9D72E1C87AEBB4117ABB5B63A711F7AE80F868EBB268AA457B655177A3162423334BCECD4793B5641D129D202B347FF74AC51CC542C60C8215682B08EF510CF18F57E83F563F83BF0218F193375456DF1AE7280470F228C40A8F5379867168C7DDB72AB7C6E9DB1603378529BC65CF57BB67587C2C98C41910A86FD53150AF8021C041AED3F10A540708D0199C7DC9DB2D01F098296974BD579E9542F1A1AEC452D8DC094C6A7695B13B2FA0A7CA15E8636FE6A5BB774057E7E92C13E718A2F19999488F74A19BDA01F80ED9484A9F6169242AE0B4EE2F17710877540BC8318FD367221579413B16E17A4DDA8378F64F1DD433F05B1A41E3C09F6DD453D62D5978A04512E09DD06FAF07E3E97A0F6BC8D815B16B56AA98B03A3D0555FDB58DE32B2282BFFF6A237296A2B22385731653E08E71A7B47B8900E960F2C06885179CD1D6B23575914FB4EF7CCE93AFDF3F3D3B3FD95B1DF9DCDFBE71FCF88DF3F3B85FE47ED5E84636B0C8759C5AA4E9E403003515A6FBEB0342F9F098BF1EEA4119F3AEB83A04B0CC95684EE5E04FDDE2A2CBD6610D37035BB158A5584F202AE6C3BFA06566A43F8505E164199E56055BF14790AAA543155AFCCA5AC4A371BE4A6E42B742CA714371D53F271C6DD32CF0C26248A3090C67C939D58D374B8197D981EDEF88314C3F5E486FE5F685B48C2CC250BA8DDEAAAECC32D1532B17F46F44B19F94183AC19912DDECEE5559D5EEFF1650C727AFD7B56FBF6CC2075B0D29DB76861802D3B31160A95368C400D8864E6248C880D63C4286471C0B78D22BBB8AB15C9C4A9DE1C845857293B6A8F61B47C13C7383E00ABD6D42B80B5BBF6A879EF36D1F2B3F628E9733731D293F608691B3611D293F608668F3571CCF3F668461B35C18CE326D6C0ADBD8EFA5B741B8FB1366AD7DFF6AEE2582729A41745B2560C075961DABF01362A554A625BE8A425F5932AB5960A024713E8B2316214ED2D092684D3397A2AEDB93800767BB53DF2FFB3D3B952FAECC0C5EEDD572BAABDBB77793A7CEF696C5389A0C60830C6196935B4FF4C182F2CEAAF12C6AC9099E5A763DD0B4C800BAB6BFDD5825CD79A162C75B2D7AD787C4984F742C44F0159FD6C421DB5C6E5686FE3B6DEE16EDBCE52276B6E6507DABE71B17C5B07F40F7740FFF5965577D837B1A8A2E269BB18BD8125E69A8C66CC924DF9A84C3757E3573D99E6FAFB2AB8C68AEB6339D45F3BC36CC57D10E0D1F43BEA2F472FBC9BB6A5E608BF7B136AEE3B2D56A2B4D9A255B3100D4C35AF51519047AF4ECD2960E09A5F8B07D720E9A284D0DF8E39783AA34BD09C66CCE7611E1D34DBD42827A9056F028A60BCC8A550744E3C5C87430FA44C3E8664EBEC0DAEBBFE98DFC72A8AD5A594B8FEB2CAAA387077CB4FF6C3AACE83FB48FF25DFC2045493EA94BBE7C9B78842EFDB0DE9B505422752D6C851ABA9D20D7DB12E90EE42DE122873DF3544C0F518F00841C4104CDEF32959C231BA6141FA0A0BE2ADF3616E3BC8FE4054DD3EB8A664214820338C925FFF07C4D5FF02F9F41F67CB7ADE34190000 , N'6.1.3-40302')
END

IF @CurrentMigration < '201907222247540_activity-log'
BEGIN
    CREATE TABLE [dbo].[SqlBotActivityLogEntities] (
        [Id] [nvarchar](128) NOT NULL,
        [FromId] [nvarchar](max),
        [FromName] [nvarchar](max),
        [RecipientId] [nvarchar](max),
        [RecipientName] [nvarchar](max),
        [TextFormat] [nvarchar](max),
        [TopicName] [nvarchar](max),
        [HistoryDisclosed] [bit] NOT NULL,
        [Local] [nvarchar](max),
        [Text] [nvarchar](max),
        [Summary] [nvarchar](max),
        [ChannelId] [nvarchar](max),
        [ServiceUrl] [nvarchar](max),
        [ReplyToId] [nvarchar](max),
        [Action] [nvarchar](max),
        [Type] [nvarchar](max),
        [Timestamp] [datetimeoffset](7) NOT NULL,
        [ConversationId] [nvarchar](max),
        CONSTRAINT [PK_dbo.SqlBotActivityLogEntities] PRIMARY KEY ([Id])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201907222247540_activity-log', N'Carubbi.BotEditor.Api.Migrations.Configuration',  0x1F8B0800000000000400DD5A5F6FDB36107F1FB0EF20E869035229B6DBAE0B9C0EA9936CC1922688D3BED3D2D92126511A490536867DB23DEC23ED2BECA8BF9464D99265BB459197E848FE8EF787C7E39DFFFBE7DFF12F4BDF335E800B1AB07373609D9A06302770295B9C9B919CBF7A67FEF2FEFBEFC657AEBF343E67F3466A1EAE64E2DC7C96323CB36DE13C834F84E553870722984BCB097C9BB8813D3C3DFDD91E0C6C400813B10C63FC1831497D883FF073123007421911EF2E70C113291D47A631AAF191F82042E2C0B97949175412EF891317AC0F81BC72A90CB87511526B2A8904D3B8F028C17D4DC19B9B06612C4032EEFAEC9380A9E4015B4C432420C42A049C37279E80549AB3627A5BC14E874A30BB58984139919081DF1170304A35655797EFA46F33D724EAF20A752E574AEA589FA8A13F3D54E08523E90B0EDC068B64866954799F4D3CAED66DD7BED580796234AF3CC9FD0ADD4FFD9D1893C8931187730691E4C43B311EA299479DDF61F514FC01EC9C459EA7CB86D2E1588980A4071E84C0E5EA11E6A9C437AE69D8E575767561BE4C5B93088FDE83C7C234EEC8F216D8423EE38119BE338D6BBA0437A3A4EEF489513C45B848F2083F3FE286C9CC837CDCDEC8F39A07FE46BEF86F2BBEDBD9A8FF0ECEE8111C1A5260F20842E5BC8E22D9132CE575C07D220FCF2A08A97314A17EA378FEF9EA920AC70B04E436FB10041E10D6D99D6F0387784731C5C1994C23DF277C75703E93670CBFE01DE1BC4C81BF50073EF1C35BE811420F23F81184521790BA330FED72087F782698290949FC30E3748917AD22DECFE70264E7D388D9964AF8E29B7DEFA618DB459AD122F94051C8DEB28E02EC9B48376E981C0DD75857D3D01465825F8101472DB80F444AE04C6140AAD3CD9E807A89114A6E8C69B3551EE8E85FB8F80827BC4D80C44C781F9CDA9E97FDB0C3670A3F021B7558F27B9DB2F84E6B63A4CDA8574F64F12DDD58FD626F73308C7C2D14964FDB8DB8F6C8A278983687C5BBFCE98708D687887A2E70EB129FB6C14258183E30182046E9349F186B57154171640D4FAD81F57AB83D2C8E06B3F9E8DD9BB7C41DBD7D0DA3374AB788E5ADD0167A082B6BF80EFC19F04274FD78254EF99978118E9DD68C535DFAC0E90BDAA31161B015411DB6D29261DD8289ADEA9719B29584B21CAEB884D4489C8CD66C87FC52F389D401CBFB4B90A720B53C267D489B46E14C69986E7CC0DB9B51D36D3622EAB7F23A7FCE252F0A357652A9C92A3A764349677C47C210DD432BF1A414639AD47726AFA6DD4B1D7E82613B624DC523DF6DCE090F0359406554057A17AE2917B1FC33A20EDFC4F56BD3EA766ED076C6AF6ECA6AEA50D8215BA3FE4F03F58E25972A9342D5D728BD8F1942AC08C8B7DB5C10AA21C59539E211BE267999045EE4B3A60468D3EAACEAA12364B46E28C92BB98A9350DB2395AA163A58696007BCFAF62A43ED31F5FA830EA8D33BA01525861258416E8F552F22E890F5D1F6C8693941874B49DDF456D7581784BC12A083E4C4F6385A22AB2369E40E7BD232A3D2B6347A177FCD9FEB655FCDC9EDB1B207B90E94D13A582DCE904A568B291D108A84AE0453903B58AEF2302899AF3256471DDB95705CBD14ECDAAD50794A562F9A56D75076F71FE00AD2D2865DEF9E4D1087B974CAC9B78E531EE98458DD524AFA3241A19F9B36A166CF541D2DA3B54749D2501D23A1B447485E9C3A4242F9524173970073D050504BDAAB5372EE79F25E49D2C769C2BCBD395BCBA09329A6814A7AA16E9C3DAF8404DF521354D898782AEB2926DC1146E7A8A9E485690E4F07C34A47F7EBE9AEDA42B8DE6E2DD6A31713D90BE1CE33E1F5EE65AFD66406FB834F963FEA58BBB41F7B81AD6931EE076F6F3BACB70AFBC155DB81BDD09A5A7E33DABDC1506AF7F556D95E802A6DBB5E58B5CA73BF9DD58A993DDDB6D262EB85566EA3F533A5D663E807542DC9BA9881AA5F13056949F681E3D14D7EA7F4D39E9A631D36BC7B03ECE877025517EFD61652F7EE4FADA71433AAD5426F980BCB73F3AF78E19941DD65BC303D5EBA214E8C7B8EB9C1993130FE6E315DA5A12D9654A7F56B741D26A4EC476DC3EE6A6B5E529D56EF4D75947DE389DB8F0246DD1530EA2F59B993B717894A5B7CDDCE467B90446F16A218B3B85FB893A7EB0DC2AFE9DEDCE7ADB2F90AA8B68DEA5D87CDCD9BC6A64FFBF650F22A431967018A9BC8B17E3205B1B59B54EF19B5682B356F219F55E3DDA1FD547FB18E6DFD47C7E34B10745140A89F203388B39D02349B73C3E641E62E28B6BEA36C4AC59BEE4012742072C1259D1347E2B00342C43DEAB4D178E5CFC0BD61F7910C23792104F833AF54371EDB9BF9C73DB6F29EC7F7A1FA12FB1001B749D519B867718B38DFF7F51A7F6F80509E9D6616B8ABA95419C66295237D0C584BA0547D9710025379C913F8A18760E29E4DC90BECB2378C90B7B020CE2A2B3C34836C374459EDE34B4A169CF822C528D6E327FAB0EB2FDFFF0F2EF49E2F7B2F0000 , N'6.2.0-61023')
END

